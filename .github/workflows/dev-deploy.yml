name: Development Deploy
on:
  push:
    branches: [ dev ]

jobs:
  deploy:
    runs-on: ubuntu-latest
    environment: development
    steps:
      - name: ðŸš€ Setup SSH
        uses: webfactory/ssh-agent@v0.9.0
        with:
          ssh-private-key: ${{ secrets.SSH_PRIVATE_KEY }}
      
      - name: ðŸ”‘ Add SSH host key
        run: |
          mkdir -p ~/.ssh
          ssh-keyscan -p 2248 90.60.191.159 >> ~/.ssh/known_hosts
      
      - name: ðŸš€ Deploy to Development
        run: |
          ${{ secrets.SSH_COMMAND }} << 'EOF'
          set -e
          echo "ðŸŽ¯ Starting development deployment..."
          
          cd ~/side-stuff/cozy-bot
          
          # Git operations
          echo "ðŸ“ Updating code..."
          git stash push -m "auto-stash before deploy $(date)"
          git checkout dev
          git pull origin dev
          
          # Check if required files exist
          echo "ðŸ” Checking environment files..."
          if [ ! -f ".env.dev" ]; then
            echo "âŒ .env.dev not found on server!"
            echo "Please create .env.dev file manually on the server"
            exit 1
          fi
          
          # Deploy
          echo "ðŸš€ Running deployment script..."
          chmod +x deploy-dev.sh
          ./deploy-dev.sh
          
          echo "âœ… Development deployment completed!"
          EOF